(()=>{"use strict";var e={1890:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=["https://app1.localhost","https://localhost","https://www.breinertech.me","https://breinertech.me"];t.default=()=>(e,t)=>{-1===o.indexOf(e)&&e?new Error(`Acceso a ${e} no permitido por el CORS`):t(null,!0)}},1888:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(5900),i=o(8404);n(o(9050)).default.info("Iniciando configuración de la base de datos");const s=new r.Pool({host:i.DB_HOST,user:i.DB_USER,password:i.DB_PASSWORD,database:i.DB_NAME,port:i.DB_PORT,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});t.default=s},9050:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7773),i=o(1017),s=o(7147),{colorize:a,combine:c,printf:u}=r.format,d=n(o(8114)),l=(0,i.resolve)(__dirname,"../logs");(0,s.existsSync)(l)||(0,s.mkdirSync)(l),t.default=(0,r.createLogger)({level:"debug",transports:[new r.transports.Console({format:c(a({level:!0}),u((({level:e,message:t})=>`[${e}]: ${t} -- ${(0,d.default)(new Date).format("dddd, DD/MM/YYYY, HH:mm:ss")}`)))}),new r.transports.File({filename:`${l}/debugger.log`,format:u((({level:e,message:t})=>`[${e}]: ${t} -- ${(0,d.default)(new Date).format("dddd, DD/MM/YYYY, HH:mm:ss")}`))})]})},1580:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.disconnect=t.query=t.queryCallback=t.connect=void 0;const r=n(o(1888));t.connect=()=>r.default.connect().catch((e=>{throw e})),t.queryCallback=(e,t,o)=>r.default.query(e,t&&t,o),t.query=(e,t)=>r.default.query(e,t&&t).catch((e=>{throw{status:500,msg:e.message}})),t.disconnect=()=>r.default.end()},7403:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.serverCert=t.serverKey=void 0;const r=n(o(1017)),i=n(o(7147));n(o(9050)).default.info("Iniciando configuración de certificados SSL"),t.serverKey=i.default.readFileSync(r.default.join(`${__dirname} ../..`,"cert","key.pem")),t.serverCert=i.default.readFileSync(r.default.join(`${__dirname} ../..`,"cert","cert.pem"))},8404:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SEED_ACCESS_TOKEN=t.NAME_SERVER=t.DB_PORT=t.DB_NAME=t.DB_PASSWORD=t.DB_USER=t.DB_HOST=t.PORT_SOCKET=t.PORT=t.ENV=void 0,n(o(9050)).default.debug("Configurando variables de entorno"),t.ENV=String("production"),t.PORT=Number("443"),t.PORT_SOCKET=Number({SHELL:"/bin/fish",SESSION_MANAGER:"local/tuf:@/tmp/.ICE-unix/2129,unix/tuf:/tmp/.ICE-unix/2129",COLORTERM:"truecolor",XDG_CONFIG_DIRS:"/home/gt37285/.config/kdedefaults:/etc/xdg",npm_package_main:"index.js",TERM_PROGRAM_VERSION:"1.62.0",APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL:"true",NODE:"/usr/bin/node",npm_config_ignore_scripts:"",npm_package_devDependencies__types_moment:"^2.13.0",npm_package_dependencies_moment:"^2.29.1",LC_ADDRESS:"es_EC.UTF-8",LC_NAME:"es_EC.UTF-8",BREAKPAD_DUMP_LOCATION:"/home/gt37285/.config/Code - OSS/exthost Crash Reports",npm_package_devDependencies__types_winston:"^2.4.4",npm_config_argv:'{"remain":[],"cooked":["run","build"],"original":["build"]}',npm_config_bin_links:"true",DESKTOP_SESSION:"plasma",LC_MONETARY:"es_EC.UTF-8",npm_package_devDependencies__types_express:"^4.17.13",GTK_RC_FILES:"/etc/gtk/gtkrc:/home/gt37285/.gtkrc:/home/gt37285/.config/gtkrc",NO_AT_BRIDGE:"1",XCURSOR_SIZE:"24",npm_package_devDependencies_nodemon:"^2.0.13",EDITOR:"nano",npm_package_devDependencies__types_helmet:"^4.0.0",GTK_MODULES:"canberra-gtk-module",XDG_SEAT:"seat0",PWD:"/mnt/data/Code/proyectos/tesis/backend/course",npm_package_dependencies_morgan:"^1.10.0",npm_config_save_prefix:"^",XDG_SESSION_DESKTOP:"plasma",LOGNAME:"gt37285",QT_QPA_PLATFORMTHEME:"qt5ct",npm_package_devDependencies__types_pg:"^8.6.1",XDG_SESSION_TYPE:"x11",npm_package_dependencies_cors:"^2.8.5",npm_package_dependencies_express_fileupload:"^1.2.1",SYSTEMD_EXEC_PID:"846",npm_package_scripts_build:"rm -rf dist && webpack --config webpack/webpack.config --env env=prod",npm_package_devDependencies_cross_env:"^7.0.3",_:"/mnt/data/Code/proyectos/tesis/backend/course/node_modules/.bin/webpack",OMF_PATH:"/home/gt37285/.local/share/omf",XAUTHORITY:"/run/user/1000/gdm/Xauthority",VSCODE_GIT_ASKPASS_NODE:"/usr/lib/electron13/electron",npm_package_scripts_ts_init:"tsc --init",WINDOWPATH:"2",MOTD_SHOWN:"pam",GDM_LANG:"es_EC.UTF-8",npm_package_devDependencies_nodemon_webpack_plugin:"^4.7.0",GTK2_RC_FILES:"/etc/gtk-2.0/gtkrc:/home/gt37285/.gtkrc-2.0:/home/gt37285/.config/gtkrc-2.0",HOME:"/home/gt37285",USERNAME:"gt37285",npm_config_version_git_tag:"true",LC_PAPER:"es_EC.UTF-8",LANG:"es_EC.UTF-8",npm_package_devDependencies__types_morgan:"^1.9.3",npm_package_devDependencies_webpack:"^5.62.1",npm_package_devDependencies_typescript:"^4.4.3",LS_COLORS:"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:",XDG_CURRENT_DESKTOP:"KDE",npm_config_init_license:"MIT",npm_package_dependencies_uuid:"^8.3.2",npm_package_version:"1.0.0",npm_package_dependencies_socket_io:"^4.3.1",npm_package_devDependencies__types_cors:"^2.8.12",npm_config_version_commit_hooks:"true",GIT_ASKPASS:"/usr/lib/code/extensions/git/dist/askpass.sh",npm_package_dependencies_express:"^4.17.1",npm_package_dependencies_jsonwebtoken:"^8.5.1",npm_package_dependencies_adm_zip:"^0.5.9",INIT_CWD:"/mnt/data/Code/proyectos/tesis/backend/course",CHROME_DESKTOP:"code-oss.desktop",npm_package_scripts_format:"prettier --write .",KDE_SESSION_UID:"1000",npm_lifecycle_script:"rm -rf dist && webpack --config webpack/webpack.config --env env=prod",npm_package_description:"",npm_package_devDependencies__types_dotenv:"^8.2.0",npm_config_version_tag_prefix:"v",YARN_WRAP_OUTPUT:"false",npm_package_devDependencies_ts_loader:"^9.2.6",XDG_SESSION_CLASS:"user",TERM:"xterm-256color",LC_IDENTIFICATION:"es_EC.UTF-8",npm_package_dependencies_express_validator:"^6.12.1",npm_package_name:"course",npm_package_devDependencies_tsconfig_paths:"^3.11.0",npm_package_devDependencies__types_express_fileupload:"^1.1.7",USER:"gt37285",npm_package_devDependencies_webpack_merge:"^5.8.0",npm_package_dependencies_pg:"^8.7.1",npm_package_devDependencies_webpack_cli:"^4.9.1",VSCODE_GIT_IPC_HANDLE:"/run/user/1000/vscode-git-985bcffc08.sock",KDE_SESSION_VERSION:"5",npm_package_dependencies_dotenv:"^10.0.0",DISPLAY:":0",npm_lifecycle_event:"build",SHLVL:"2",npm_config_version_git_sign:"",npm_config_version_git_message:"v%s",npm_package_devDependencies_eslint_webpack_plugin:"^3.1.1",npm_package_devDependencies_eslint:"^8.5.0",npm_package_devDependencies_ts_node:"^10.2.1",LC_TELEPHONE:"es_EC.UTF-8",LC_MEASUREMENT:"es_EC.UTF-8",XDG_VTNR:"2",npm_package_devDependencies__types_jsonwebtoken:"^8.5.5",XDG_SESSION_ID:"7",npm_config_user_agent:"yarn/1.22.17 npm/? node/v17.3.0 linux x64",npm_execpath:"/usr/lib/node_modules/yarn/bin/yarn.js",npm_package_dependencies_winston:"^3.3.3",XDG_RUNTIME_DIR:"/run/user/1000",npm_config_strict_ssl:"true",npm_package_devDependencies__types_uuid:"^8.3.3",npm_package_dependencies_helmet:"^4.6.0",LC_TIME:"es_EC.UTF-8",npm_package_scripts_dev:"webpack --config webpack/webpack.config --env env=dev",npm_package_dependencies_prettier:"^2.4.1",VSCODE_GIT_ASKPASS_MAIN:"/usr/lib/code/extensions/git/dist/askpass-main.js",QT_AUTO_SCREEN_SCALE_FACTOR:"0",XCURSOR_THEME:"capitaine-light",GDK_BACKEND:"x11",KDE_FULL_SESSION:"true",npm_package_devDependencies__types_adm_zip:"^0.4.34",npm_package_dependencies__:"^0.0.1",npm_package_devDependencies_webpack_node_externals:"^3.0.0",npm_package_scripts_start:"node ./dist/bundle.js",BROWSER:"firefox",PATH:"/tmp/yarn--1642368393703-0.22373769242023167:/mnt/data/Code/proyectos/tesis/backend/course/node_modules/.bin:/home/gt37285/.config/yarn/link/node_modules/.bin:/home/gt37285/.yarn/bin:/usr/libexec/lib/node_modules/npm/bin/node-gyp-bin:/usr/lib/node_modules/npm/bin/node-gyp-bin:/usr/bin/node_modules/npm/bin/node-gyp-bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl",GDMSESSION:"plasma",npm_package_dependencies_D:"^1.0.0",ORIGINAL_XDG_CURRENT_DESKTOP:"KDE",DBUS_SESSION_BUS_ADDRESS:"unix:path=/run/user/1000/bus",npm_package_license:"ISC",KDE_APPLICATIONS_AS_SCOPE:"1",MAIL:"/var/spool/mail/gt37285",npm_config_registry:"https://registry.yarnpkg.com",npm_config_ignore_optional:"",OMF_CONFIG:"/home/gt37285/.config/omf",npm_node_execpath:"/usr/bin/node",LC_NUMERIC:"es_EC.UTF-8",TERM_PROGRAM:"vscode",npm_config_init_version:"1.0.0",PORT:"443",NAME_SERVER:"CourseAPP",DB_HOST:"ierec-test.ck2swchd02ym.us-east-2.rds.amazonaws.com",DB_USER:"postgres",DB_PASSWORD:"Lp3lkjkszpj",DB_NAME:"ierectest",DB_PORT:"5432",SEED_ACCESS_TOKEN:"acessTokenseedPass"}.PORT_SOCKET),t.DB_HOST=String("ierec-test.ck2swchd02ym.us-east-2.rds.amazonaws.com"),t.DB_USER=String("postgres"),t.DB_PASSWORD=String("Lp3lkjkszpj"),t.DB_NAME=String("ierectest"),t.DB_PORT=Number("5432"),t.NAME_SERVER=String("CourseAPP"),t.SEED_ACCESS_TOKEN=String("acessTokenseedPass")},7549:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,o)=>(e.status||(e.status=500),o.status(e.status).json(e))},5371:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(8114));t.default=(e,{req:t,location:o,path:n})=>(0,r.default)(e).isValid()},8114:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(2245));r.default.locale("es"),t.default=r.default},7093:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(9470),i=n(o(9050)),s=o(1017),a=o(7147),c=n(o(8114));class u{constructor(){this.dateNow=(0,c.default)(new Date),this.init()}static init(){return u.instace||(i.default.warn("Configurando nueva instancia de librería morgan"),this.instace=new u),i.default.info("Iniciando configuración de librería morgan"),this.instace}init(){let e="../logs";(0,a.existsSync)(e)||(0,a.mkdirSync)(e),this.tokens(),this.formats()}tokens(){(0,r.token)("date",(()=>this.dateNow.format("dddd, DD/MM/YYYY, HH:mm:ss "))),(0,r.token)("uid",((e,t)=>{const o=e.decoded;return(null==o?void 0:o.uid)?o.uid.toString():""}))}formats(){return i.default.info("configurando formato para archivos logs"),(0,r.format)("personalizado",':remote-addr :uid - [:date] ":method :url - HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent')}stream(e){return(0,a.createWriteStream)((0,s.join)(__dirname,`../logs/${e}`),{flags:"a"})}accesLog(){return i.default.info("Generando archivo de logs -> acceso"),{skip:(e,{statusCode:t})=>!(t>=200&&t<300),stream:this.stream("access.log")}}errorLog(){return i.default.info("Generando archivo de logs -> error"),{skip:(e,{statusCode:t})=>t>=200&&t<300,stream:this.stream("error.log")}}}t.default=u},3607:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(4053)),s=o(1580),a=o(8404),c=r(o(9050));n(void 0,void 0,void 0,(function*(){try{yield(0,s.connect)(),c.default.info(`Iniciando configuración en el ambiente ${a.ENV}`),i.default.init(a.PORT,a.NAME_SERVER).listenServerSSL()}catch(e){throw new Error(e.message)}}))},7077:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.verifyToken=t.verifyJWT=void 0;const i=o(9344),s=o(8404),a=r(o(7549));t.verifyJWT=(e,o,r)=>n(void 0,void 0,void 0,(function*(){const n=e.header("x-token");if(!n)return o.status(400).json({ok:!1,msg:"El token no existe!"});try{const o=yield(0,t.verifyToken)(n,s.SEED_ACCESS_TOKEN).catch((e=>{throw"jwt expired"===e.message&&(e=Object.assign(Object.assign({},e),{status:401})),e}));return e.decoded=o,r()}catch(t){(0,a.default)(t,e,o)}})),t.verifyToken=(e,t)=>new Promise(((o,n)=>{(0,i.verify)(e,t,((e,t)=>e?n(e):o(t)))}))},4616:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsActividad=t.verifyEndDate=t.verifyInputTried=t.verifyInputType=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","nombre necesario, o el mismo es incorrecto"),t.verifyInputType=(0,n.verifyInputNumeric)("tipo","el tipo de actividad es necesario, o el mismo es incorrecto"),t.verifyInputTried=(0,n.verifyInputNumeric)("intentos","Los intentos disponibles son obligatorios o el mismo es incorrecto").isFloat({min:1,max:5}),t.verifyEndDate=(0,n.verifyInputDate)("f_limite","La fecha limite es necesaria o la misma es incorrecta"),t.verifyInputsActividad=[t.verifyInputName,t.verifyInputType,t.verifyInputTried,t.verifyEndDate]},2880:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsCourse=t.verifyFInicioDate=t.verifyInputPrice=t.verifyInputDescription=t.verifyInputLevel=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","el nombre es necesario"),t.verifyInputLevel=(0,n.verifyInputNumeric)("nivel","específica un nivel o el mismo es incorrecto").isIn([1,2,3]),t.verifyInputDescription=(0,n.verifyInputText)("descripcion","especifica una descripcion"),t.verifyInputPrice=(0,n.verifyInputNumeric)("precio","específica un precio o el mismo es incorrecto"),t.verifyFInicioDate=(0,n.verifyInputDate)("f_inicio","especifica una fecha o la misma es incorrecta"),t.verifyInputsCourse=[t.verifyInputName,t.verifyInputLevel,t.verifyFInicioDate]},9804:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputDate=t.verifyInputText=t.verifyInputNumeric=void 0;const r=o(3553),i=n(o(5371));t.verifyInputNumeric=(e,t)=>(0,r.check)(e,t).not().isEmpty().isNumeric(),t.verifyInputText=(e,t)=>(0,r.check)(e,t).not().isEmpty().isString().trim(),t.verifyInputDate=(e,t)=>(0,r.check)(e,t).not().isEmpty().custom(i.default)},1891:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsModules=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","el nombre es necesario"),t.verifyInputsModules=[t.verifyInputName]},5508:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsObjetivos=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","el nombre es necesario"),t.verifyInputsObjetivos=[t.verifyInputName]},1417:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsRequirements=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","el nombre es necesario"),t.verifyInputsRequirements=[t.verifyInputName]},5519:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsScore=t.verifyInputScore=void 0;const n=o(9804);t.verifyInputScore=(0,n.verifyInputNumeric)("calificacion","La calificacion es necesaria o la misma es incorrecta").isFloat({min:1,max:10}),t.verifyInputsScore=[t.verifyInputScore]},5775:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsTActividad=t.verifyInputPorcentaje=t.verifyInputCurso=t.verifyInputHoraNombre=void 0;const n=o(9804);t.verifyInputHoraNombre=(0,n.verifyInputText)("nombre","nombre necesario, o el mismo es incorrecto"),t.verifyInputCurso=(0,n.verifyInputNumeric)("curso","el ID del curso es obligatorio o el mismo es incorrecto"),t.verifyInputPorcentaje=(0,n.verifyInputNumeric)("porcentaje","el porcentaje es necesario o el mismo es incorrecto").isFloat({min:0,max:100}),t.verifyInputsTActividad=[t.verifyInputHoraNombre,t.verifyInputCurso,t.verifyInputPorcentaje]},6882:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyInputsTemario=t.verifyInputName=void 0;const n=o(9804);t.verifyInputName=(0,n.verifyInputText)("nombre","el nombre es necesario"),t.verifyInputsTemario=[t.verifyInputName]},808:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=o(3553);t.default=(e,t,o)=>{const r=(0,n.validationResult)(e);return r.isEmpty()?o():t.status(400).json({ok:!1,err:r.formatWith((({location:e,msg:t,param:o,value:n,nestedErrors:r})=>`${t}`)).mapped()})}},3252:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.verifyAdmin=t.verifyDocente=void 0;const r=n(o(9050));t.verifyDocente=(e,t,o)=>i(e,"maestro")?o():t.status(401).json({ok:!1,msg:"No tienes permisos para acceder a este recurso"}),t.verifyAdmin=(e,t,o)=>{const{uid:n}=e.decoded;return i(e,"admin")?o():(r.default.warn(`Se bloqueo el intento de acceso a recursos de administrador al usuario ${n}`),t.status(401).json({ok:!1,msg:"No tienes permisos para acceder a este recurso"}))};const i=(e,t)=>{const{roles:o}=e.decoded;return!!o.includes(t)}},9345:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(2880),i=n(o(808)),s=o(5520),a=o(5520),c=n(o(5290));class u extends c.default{constructor(){super(),this.routes()}static init(){return this.instance||(this.instance=new u),this.instance}routes(){this.route.route("/courses/:pagina").get(s.getAllAdminCourses),this.route.route("/courses/close/:pagina").get(s.getAllAdminCloseCourses),this.route.route("/course").post([...r.verifyInputsCourse,i.default],s.createCourse),this.route.route("/course/search/:pagina").post(a.searchCourse),this.route.route("/course/search/close/:pagina").post(s.searchCourseClose),this.route.route("/course/:id").get(s.getCourseByIdAdm).put([...r.verifyInputsCourse,i.default],s.editCourse).delete(s.deleteCourse),this.route.route("/course/public").post(s.publicCourse),this.route.route("/matriculas/course/:id").get(s.getMatriculasByCourse),this.route.route("/course/update/:cid").put(s.updateCourseInfo),this.route.route("/course/teacher/update").put(s.updateTeacherCourse),this.route.route("/course/certificated/:cid").get(s.generateGradesAndPromedios),this.route.route("/dashboard").get(s.getDashboardActivities)}}t.default=u},5290:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(3252),s=o(6860),a=n(o(9050));t.default=class{constructor(){a.default.info("Configurando nueva instancia del punto de acceso a admin"),this.route=(0,s.Router)(),this.middlewares()}middlewares(){this.route.use([r.verifyJWT,i.verifyAdmin])}get Routes(){return this.route}}},9140:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(5520),i=n(o(5290));class s extends i.default{constructor(){super(),this.routes()}static init(){return this.instance||(this.instance=new s),this.instance}routes(){this.route.route("/by-course/:cid").get(r.getSalesByCourse),this.route.route("/bill/admin/:page").get(r.getPaymentsAdminData),this.route.route("/bill/admin/search/:page").get(r.searchPaymentsAdminData)}}t.default=s},4939:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(3754),i=o(6860),s=n(o(9050));class a{constructor(){s.default.info("Configurando nueva instancia del punto de acceso a rutas de calendario"),this.route=(0,i.Router)(),this.MainRoutes()}static init(){return this.instance||(this.instance=new a),this.instance}MainRoutes(){this.route.route("/activities/:est").get(r.getActivitiesReport),this.route.route("/docente/:prof").get(r.getEventsTeachClass),this.route.route("/student/:est").get(r.getEventsStudentClass)}get Routes(){return this.route}}t.default=a},9159:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(4616),i=o(5519),s=o(5775),a=n(o(808)),c=n(o(191)),u=o(2109);class d extends c.default{constructor(){super(),this.type_activities(),this.activities(),this.reports()}static init(){return this.instance||(this.instance=new d),this.instance}type_activities(){this.route.route("/tact/opt/:taid").delete(u.deleteTActividad),this.route.route("/tact").post([...s.verifyInputsTActividad,a.default],u.addTipoActividad).put([...s.verifyInputsTActividad,a.default],u.editTipoActividad)}activities(){this.route.route("/activity/:cid").post([...r.verifyInputsActividad,a.default],u.createActivity),this.route.route("/activity/:aid").put([...r.verifyInputsActividad,a.default],u.updateActivity).delete(u.deleteActivity)}reports(){this.route.route("/activity/report/:aid").get(u.getReportsScore),this.route.route("/activity/report/:est/:act").put([...i.verifyInputsScore,a.default],u.setScore)}}t.default=d},7553:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(2109),i=n(o(191));class s extends i.default{constructor(){super(),this.InitRoutes()}static init(){return this.instance||(this.instance=new s),this.instance}InitRoutes(){this.route.route("/:pagina").get(r.getAllCourses),this.route.route("/search/:pagina").post(r.searchCourse)}}t.default=s},191:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(3252),s=o(6860),a=n(o(9050));t.default=class{constructor(){a.default.info("Configurando nueva instancia del punto de acceso a rutas de docentes"),this.route=(0,s.Router)(),this.middlewares()}middlewares(){this.route.use([r.verifyJWT,i.verifyDocente])}get Routes(){return this.route}}},7854:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(1891),i=n(o(808)),s=o(2109),a=n(o(191));class c extends a.default{constructor(){super(),this.CRUD()}static init(){return this.instance||(this.instance=new c),this.instance}CRUD(){this.route.route("/:cid").post([...r.verifyInputsModules,i.default],s.createModule).get(s.getModulesByCourse),this.route.route("/:cid/:mid").delete(s.deleteModule).put([...r.verifyInputsModules,i.default],s.updateModule),this.route.route("/link/:cid/:mid").put(s.updateModuleLink)}}t.default=c},2738:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(1417),i=n(o(808)),s=o(2109),a=n(o(191));class c extends a.default{constructor(){super(),this.CRUD()}static init(){return this.instance||(this.instance=new c),this.instance}CRUD(){this.route.route("/:cid").post([...r.verifyInputsRequirements,i.default],s.addReq).get(s.getAllRequirements),this.route.route("/opt/:rid").put([...r.verifyInputsRequirements,i.default],s.updateReq).delete(s.deleteReq)}}t.default=c},9360:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(5508),i=n(o(808)),s=o(2109),a=n(o(191));class c extends a.default{constructor(){super(),this.CRUD()}static init(){return this.instance||(this.instance=new c),this.instance}CRUD(){this.route.route("/:cid").post([...r.verifyInputsObjetivos,i.default],s.addTarget).get(s.getAllTargets),this.route.route("/opt/:oid").put([...r.verifyInputsObjetivos,i.default],s.updateTarget).delete(s.deleteTarget)}}t.default=c},470:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(6882),i=n(o(808)),s=o(2109),a=n(o(191));class c extends a.default{constructor(){super(),this.CRUD()}static init(){return this.instance||(this.instance=new c),this.instance}CRUD(){this.route.route("/:mid").post([...r.verifyInputsTemario,i.default],s.addNewTema),this.route.route("/opt/:tid").put([...r.verifyInputsTemario,i.default],s.editTema).delete(s.deleteTema)}}t.default=c},8479:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(6860),i=n(o(7553)),s=n(o(7854)),a=n(o(470)),c=n(o(9360)),u=n(o(2738)),d=n(o(9159)),l=n(o(3643)),f=n(o(3618)),p=n(o(9705)),m=n(o(2047)),_=n(o(4939)),v=n(o(9345)),y=n(o(9140)),h=n(o(454));class g{constructor(){this.route=(0,r.Router)(),this.route.use("/course",i.default.init().Routes),this.route.use("/modules",s.default.init().Routes),this.route.use("/temario",a.default.init().Routes),this.route.use("/target",c.default.init().Routes),this.route.use("/requirements",u.default.init().Routes),this.route.use("/activities",d.default.init().Routes),this.route.use("/shop",l.default.init().Routes),this.route.use("/adj",f.default.init().Routes),this.route.use("/portada",p.default.init().Routes),this.route.use("/student",m.default.init().Routes),this.route.use("/calendar",_.default.init().Routes),this.route.use("/admin",v.default.init().Routes),this.route.use("/shopping",h.default.init().Routes),this.route.use("/sales",y.default.init().Routes)}static init(){return this.instance||(this.instance=new g),this.instance}get Routes(){return this.route}}t.default=g},7862:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(6860),s=n(o(9050));t.default=class{constructor(){s.default.info("Configurando nueva instancia del punto de acceso a rutas de pagos"),this.route=(0,i.Router)(),this.middlewares()}middlewares(){this.route.use(r.verifyJWT)}get Routes(){return this.route}}},454:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(9880),s=n(o(7862));class a extends s.default{constructor(){super(),this.routes()}static init(){return this.instance||(this.instance=new a),this.instance}routes(){this.route.route("/create").post(i.createShoppingCart),this.route.route("/:_id").post(i.addCourseToShoppingCart).delete(i.deleteItemFromShoppingCart),this.route.route("/").get(i.getShoppingCartPending),this.route.route("/all/:_id").delete(i.deleteShoppingCart),this.route.route("/payment").put(i.paymentCourses),this.route.route("/bill/:page").get(r.verifyJWT,i.getPayments),this.route.route("/bill/search/:page").get(r.verifyJWT,i.searchPayments)}}t.default=a},2047:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(6891),s=o(2599),a=o(6860),c=n(o(9050));class u{constructor(){this.route=(0,a.Router)(),this.MainRoutes()}static init(){return this.instance||(c.default.info("Configurando nueva instancia del punto de acceso a rutas de estudiante"),this.instance=new u),this.instance}MainRoutes(){this.route.route("/activity/:est").post(s.addReporte),this.route.route("/reports/:cid/:est").get(s.getReportesByStudent),this.route.route("/report/update/:est/:aid").put([r.verifyJWT],s.updateReporte),this.route.route("/course/enrollment/:cid").get([r.verifyJWT],s.verifyEnrollment),this.route.route("/register").post(s.registerNewUser),this.route.route("/tasks/:uid").get([r.verifyJWT],s.getAllTaskByStudent),this.route.route("/comments").post([r.verifyJWT],i.addNewComment),this.route.route("/comments/:cid").get([r.verifyJWT],i.getCommentsByCourse),this.route.route("/comment/:id").delete([r.verifyJWT],i.deleteComment),this.route.route("/comment/add-like").put([r.verifyJWT],i.addLike),this.route.route("/comment/add-dislike").put([r.verifyJWT],i.addDislike),this.route.route("/comment/child/:id").get([r.verifyJWT],i.getCommentsChild),this.route.route("/activities/:cid").get([r.verifyJWT],s.getActivitiesByCourse),this.route.route("/courses/landing").get(s.getCoursesLanding),this.route.route("/count/verify/enrollment/cert").get([r.verifyJWT],s.getCountCourseProfile)}get Routes(){return this.route}}t.default=u},3618:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(7345)),i=o(4945);class s extends r.default{constructor(){super(),this.Adj()}static init(){return this.instance||(this.instance=new s),this.instance}Adj(){this.route.route("/upload/adj/:cid").post(i.uploadAdjunto),this.route.route("/:cid").get(i.getAdjuntosByCourse).delete(i.deleteAdjByCourse),this.route.route("/download/:cid").post(i.downloadFiles),this.route.route("/update").put(i.editNameAdjunto)}}t.default=s},7345:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=o(6860);t.default=class{constructor(){this.route=(0,n.Router)()}get Routes(){return this.route}}},9705:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(3252),s=o(4945),a=n(o(7345));class c extends a.default{constructor(){super(),this.Portada()}static init(){return this.instance||(this.instance=new c),this.instance}Portada(){this.route.route("/get/:name").get(s.getImgPortada),this.route.route("/:cid").put([r.verifyJWT,i.verifyAdmin],s.uploadImgPortadaCourse)}}t.default=c},3643:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7077),i=o(2109),s=o(4945),a=n(o(7345)),c=o(6716);class u extends a.default{constructor(){super(),this.CRUD(),this.Several(),this.Matricula(),this.Mine()}static init(){return this.instance||(this.instance=new u),this.instance}Several(){this.route.route("/utils/horario/:cid").get(r.verifyJWT,i.getHorarioByCourse),this.route.route("/tact/:cid").get(r.verifyJWT,i.getTipoActividad),this.route.route("/activity/doc/:cid").get(s.getActivitiesByCourse),this.route.route("/activity/:cid").get(r.verifyJWT,s.getActivitiesByCourseAndStudent)}CRUD(){this.route.route("/course/:pagina").get(c.getCoursesShop),this.route.route("/course/search/:pagina").post(c.searchCourseShop),this.route.route("/course/detail/:cid").get(r.verifyJWT,c.getCourseByIdAndStudent),this.route.route("/course/details/landing/:cid").get(c.getCourseDetail),this.route.route("/course/target/detail/:cid").get(c.getTargetByCourse),this.route.route("/course/req/detail/:cid").get(c.getReqByCourse),this.route.route("/course/mod/detail/:cid").get(i.getModulesByCourse)}Matricula(){this.route.route("/course/verify/matricula/:cid").get(r.verifyJWT,c.verifyEnrollment)}Mine(){this.route.route("/me/courses").get(r.verifyJWT,c.getMyCourses),this.route.route("/me/courses/certificate/register").get(r.verifyJWT,c.getMyCoursesCertificates)}}t.default=u},6557:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(o(6860)),c=s(o(7806)),u=s(o(3582)),d=s(o(9470)),l=s(o(1890)),f=s(o(6674)),p=s(o(7093));t.default=class{constructor(){this.app=(0,a.default)(),this.morganConfig=p.default.init(),this.middlewares()}middlewares(){this.security(),this.Files(),this.BodyParser(),this.log_register()}security(){this.app.use((0,c.default)()),this.app.use((0,u.default)({origin:(0,l.default)()}))}Files(){this.app.use((0,f.default)())}log_register(){this.app.use((0,d.default)("personalizado",this.morganConfig.accesLog())),this.app.use((0,d.default)("personalizado",this.morganConfig.errorLog()))}BodyParser(){this.app.use((0,a.urlencoded)({extended:!0})),this.app.use((0,a.json)())}get App(){return this.App}}},4053:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(6557)),i=n(o(8479)),s=n(o(3685)),a=n(o(5687)),c=o(7403),u=n(o(9050));class d extends r.default{constructor(e,t){super(),this.route_prex="/api/v1",this.port=e,this.nameApp=t,u.default.info(`Configurando nueva instancia del servidor ${t}`),this.endPoints()}static init(e,t){return new d(e,t)}endPoints(){this.app.use(`${this.route_prex}`,i.default.init().Routes)}listenServer(e){const t=s.default.createServer(this.app);return t.listen(this.port,e?e():()=>u.default.info(`Escuchando aplicación en ${t.address().address}:${t.address().port}`))}listenServerSSL(e){return a.default.createServer({key:c.serverKey,cert:c.serverCert},this.app).listen(this.port,(()=>e?e():u.default.info(`Escuchando aplicación ${this.nameApp} en el puerto ${this.port}`)))}get Port(){return this.port}get NameApp(){return this.NameApp}}t.default=d},5520:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDashboardActivities=t.searchPaymentsAdminData=t.getPaymentsAdminData=t.getSalesByCourse=t.generateGradesAndPromedios=t.updateTeacherCourse=t.updateCourseInfo=t.getMatriculasByCourse=t.publicCourse=t.deleteCourse=t.editCourse=t.getCourseByIdAdm=t.searchCourseClose=t.searchCourse=t.createCourse=t.getAllAdminCloseCourses=t.getAllAdminCourses=void 0;const i=o(1580),s=r(o(7549)),a=r(o(8114)),c=o(7147),u=o(1017);t.getAllAdminCourses=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.pagina,n=10;let r=n*Number(o)-n;const{rows:s}=yield(0,i.query)("select count(*) as total_registros from curso where certificado=false"),a="select c.*,n.nombre as nivel \n            from curso c \n            inner join nivel n \n            on c.nivel = n._id \n            where c.certificado=false\n            order by c._id \n            limit $1 \n            offset $2;";r<0&&(r=0);const{rows:c}=yield(0,i.query)(a,[n,r]);return t.json({ok:!0,totalReg:Number(s[0].total_registros),docs:c})}catch(o){return(0,s.default)(o,e,t)}})),t.getAllAdminCloseCourses=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.pagina,n=10;let r=n*Number(o)-n;const{rows:s}=yield(0,i.query)("select count(*) as total_registros from curso where certificado=true"),a="select c.*,n.nombre as nivel \n            from curso c \n            inner join nivel n \n            on c.nivel = n._id \n            where c.certificado=true\n            order by c._id \n            limit $1 \n            offset $2;";r<0&&(r=0);const{rows:c}=yield(0,i.query)(a,[n,r]);return t.json({ok:!0,totalReg:Number(s[0].total_registros),docs:c})}catch(o){return(0,s.default)(o,e,t)}})),t.createCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{nivel:o,f_inicio:n,precio:r,img:s,nombre:c,cupos:u}=e.body,d=(0,a.default)(n).format("yyyy-MM-DD"),l="insert into curso(nombre,nivel,precio,f_inicio,img,cupos ) \n            values($1,$2,$3,$4,$5,$6) RETURNING _id",{rows:f}=yield(0,i.query)(l,[c,o,r,d,s.length<=0?null:s,u]);return t.json({ok:!0,_id:f[0]._id})}catch(o){return(0,s.default)(o,e,t)}})),t.searchCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{search:o,input:n}=e.body;let r="";switch(o){case"nombre":r="c.nombre";break;case"nivel":r="n.nombre";break;case"precio":r="CAST(precio AS TEXT)";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const s=`select count(*) \n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.certificado=false\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:a}=yield(0,i.query)(s),c=`select c.*, n.nombre as nivel\n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.certificado=false\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:u}=yield(0,i.query)(c);return t.json({ok:!0,totalReg:Number(a[0].count),docs:u})}catch(o){return(0,s.default)(o,e,t)}})),t.searchCourseClose=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{search:o,input:n}=e.body;let r="";switch(o){case"nombre":r="c.nombre";break;case"nivel":r="n.nombre";break;case"precio":r="CAST(precio AS TEXT)";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const s=`select count(*) \n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.certificado=true\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:a}=yield(0,i.query)(s),c=`select c.*, n.nombre as nivel\n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.certificado=true\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:u}=yield(0,i.query)(c);return t.json({ok:!0,totalReg:Number(a[0].count),docs:u})}catch(o){return(0,s.default)(o,e,t)}})),t.getCourseByIdAdm=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.id,n="select c.*,n.nombre as nivel\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            where c._id = $1",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,course:r[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.editCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.id,{nivel:n,f_inicio:r,nombre:s}=e.body,c=(0,a.default)(r).format("yyyy-MM-DD"),u="update curso set \n            nivel=$1, \n            f_inicio=$2,\n            nombre=$3\n            where _id=$4";return yield(0,i.query)(u,[n,c,s,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{_id:o}=e.body,{rows:n}=yield(0,i.query)("select count(*) from matricula where curso=$1",[o]);if(Number(n[0].count)>0)throw{status:400,msg:"El curso no se puede eliminar dado que existen estudiantes matriculados en dicho curso"};const r="delete from curso where _id=$1 RETURNING *",{rows:s}=yield(0,i.query)(r,[o]),a=s[0],d=(0,u.resolve)(__dirname,`../files/portadas/${a.img}`),l=(0,u.resolve)(__dirname,`../files/adjuntos/${a._id}`);return(0,c.existsSync)(d)&&(0,c.unlinkSync)(d),(0,c.existsSync)(l)&&(0,c.rmdirSync)(l,{recursive:!0}),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.publicCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{yield(0,i.query)("BEGIN");const{_id:o}=e.body,{rows:n}=yield(0,i.query)("select publicar as isPublic from curso where _id=$1",[o]);return n[0].ispublic?t.json({ok:!1,msg:"El curso ya se encuentra publico en la tienda"}):(yield(0,i.query)("update curso set publicar=$1 where _id=$2",[!0,o]),yield(0,i.query)("COMMIT"),t.json({ok:!0,msg:"El curso fue publicado con éxito"}))}catch(o){return yield(0,i.query)("ROLLBACK"),(0,s.default)(o,e,t)}})),t.getMatriculasByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{id:o}=e.params,n="select fact.estudiante, ma.calificacion, \n            c.nombre as curso, c._id as curso_id\n            from matricula ma\n            inner join factura fact\n            on fact._id = ma.factura\n            inner join curso c\n            on ma.curso = c._id\n            where ma.curso = $1\n            order by fact.estudiante desc",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,students:r})}catch(o){return(0,s.default)(o,e,t)}})),t.updateCourseInfo=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{type:n,input:r}=e.body;let s="";switch(n){case"desc":s="update curso set descripcion=$1 where _id=$2";break;case"detail":s="update curso set detail=$1 where _id=$2";break;case"price":s="update curso set precio=$1 where _id=$2";break;case"cupo":s="update curso set cupos=$1 where _id=$2";break;default:throw{status:400,msg:`${n} no es un tipo de consulta válido!`}}return yield(0,i.query)(s,[r,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.updateTeacherCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{teacher:o,cid:n}=e.body;return yield(0,i.query)("update curso set profesor=$1 where _id=$2",[o._id,n]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.generateGradesAndPromedios=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{rows:r}=yield(0,i.query)("select certificado from curso where _id=$1",[o]);if(r[0].certificado)throw{status:400,msg:"Ya se han generado los certificados para este curso"};const{rows:s}=yield(0,i.query)("select fact.estudiante,ma._id as matricula_id, ma.curso as curso_id,c.nombre as curso\n            from matricula ma\n            inner join factura fact\n            on ma.factura=fact._id\n            inner join curso c\n            on c._id=ma.curso\n            where curso=$1\n            and estado='pagado'\n            order by fact.estudiante desc",[o]),{rows:a}=yield(0,i.query)("select * \n            from tipo_actividad \n            where curso=$1\n            order by _id\n        ",[o]),{rows:d}=yield(0,i.query)(`select tipo, estudiante, actividad,calificacion\n            from actividades act\n            inner join reporte rep\n            on rep.actividad=act._id\n            where tipo in  (${a.map((e=>e._id)).join(",")})`),l=[];let f=0,p=0,m=0,_=0,v=0;s.forEach((({estudiante:e,matricula_id:t,curso_id:o,curso:r})=>n(void 0,void 0,void 0,(function*(){v=0,_=0,a.forEach((t=>n(void 0,void 0,void 0,(function*(){f=0,p=0,m=0;for(const o in d)d[o].tipo===t._id&&d[o].estudiante===e&&(f++,p+=Number(d[o].calificacion));m=p*Number(t.porcentaje)/(10*f),_+=m})))),v=_/10,l.push({calificacion:v.toFixed(2),curso_id:o,estudiante:e,curso:r}),yield(0,i.query)("update matricula set calificacion=$1 where _id=$2",[v.toFixed(2),t])})))),yield(0,i.query)("update curso set certificado=true where _id=$1",[o]),yield(0,i.query)("delete from tipo_actividad where curso=$1",[o]),yield(0,i.query)("delete from horario where curso=$1",[o]),yield(0,i.query)("delete from adjuntos where curso=$1",[o]),yield(0,i.query)("delete from requisitos where curso=$1",[o]),yield(0,i.query)("delete from objetivos where curso=$1",[o]),yield(0,i.query)("delete from modulos where curso=$1",[o]),yield(0,i.query)("delete\n            from comentario \n            where curso=$1",[o]);const y=(0,u.resolve)(__dirname,`../files/adjuntos/${o}`);return(0,c.existsSync)(y)&&(0,c.rmdirSync)(y,{recursive:!0}),t.json({ok:!0,students:l})}catch(o){return console.log(o),(0,s.default)(o,e,t)}})),t.getSalesByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{rows:n}=yield(0,i.query)("select sum(precio_compra) \n            from matricula where curso=$1",[o]);return t.json({ok:!0,sales:n[0].sum})}catch(o){return(0,s.default)(o,e,t)}})),t.getPaymentsAdminData=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.page,n=10;let r=n*Number(o)-n;const{rows:s}=yield(0,i.query)("select count(*) as num_registros from factura where estado = $1",["pagado"]);r<0&&(r=0);const{rows:a}=yield(0,i.query)("select fact.*, \n            json_agg(json_build_object('_id', c._id, 'nombre', c.nombre, 'precio', ma.precio_compra)) as cursos\n            from factura fact\n            inner join matricula ma\n            on fact._id=ma.factura\n            inner join curso c\n            on c._id=ma.curso\n            where fact.estado=$1\n            group by fact._id\n            order by fact._id   \n            limit $2 \n            offset $3",["pagado",n,r]);return t.json({ok:!0,numRegistros:s[0].num_registros,bill:a})}catch(o){return(0,s.default)(o,e,t)}})),t.searchPaymentsAdminData=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{type:o,input:n}=e.query;let r="";const s=e.params.page,a=10,c=a*Number(s)-a;switch(o){case"transaccion":r="fact.transaccion";break;case"id_factura":r="fact._id";break;case"fecha":r="fact.fecha";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const u=`select count(*) \n            from factura fact\n            where fact.estado=$1\n            and ${r}=$2`,{rows:d}=yield(0,i.query)(u,["pagado",n]),l=`select fact.*\n            from factura fact\n            where fact.estado=$1\n            and ${r}=$2\n            limit $3\n            offset $4`,{rows:f}=yield(0,i.query)(l,["pagado",n,a,c]);return t.json({ok:!0,numRegistros:d[0].count,bill:f})}catch(o){return(0,s.default)(o,e,t)}})),t.getDashboardActivities=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{rows:e}=yield(0,i.query)("select to_char(fecha,'Mon') as month,\n                    to_char(fecha,'MM') as number_month,\n                    sum(total) as sales\n            from factura\n            where to_char(fecha, 'yyyy') = to_char(now(),'yyyy')\n            group by 1,2\n            order by 2"),{rows:o}=yield(0,i.query)("select c.nombre as curso, count(fact.estudiante) as estudiantes,\n                sum(precio_compra) as sales\n                from matricula mat\n                inner join factura fact\n                on mat.factura=fact._id\n                inner join curso c\n                on c._id=mat.curso\n                group by 1\n                order by sales desc\n                limit 5"),{rows:n}=yield(0,i.query)("select count(*) as cursos from curso ");t.json({ok:!0,sales_month:e,students_sales:o,cursos:n[0].cursos})}catch(o){return(0,s.default)(o,e,t)}}))},3754:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getEventsStudentClass=t.getEventsTeachClass=t.getActivitiesReport=void 0;const i=o(1580),s=r(o(7549));t.getActivitiesReport=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.est,n="select re.actividad,re.url_adjunto_est, re.observaciones,\n            ac.intentos as intentos_actividad, re.intentos,ac.nombre as title,ac.url_adjunto_prof,\n            ac.f_limite as start, ac.descripcion,re.calificacion\n            from actividades ac\n            inner join reporte re\n            on ac._id=re.actividad\n            where estudiante=$1",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,activities:r})}catch(o){(0,s.default)(o,e,t)}})),t.getEventsTeachClass=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.prof,n="select m.enlace, m.nombre as modulo, \n            c.nombre as curso, m.fecha as start, c.img,\n            'clase de ' || lower(m.nombre) as title\n            from curso c \n            inner join modulos m\n            on m.curso = c._id\n            where profesor = $1\n            and fecha > now()\n            and c.certificado=false",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,classModules:r})}catch(o){(0,s.default)(o,e,t)}})),t.getEventsStudentClass=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.est,n="select m.enlace, m.nombre as modulo, c.nombre as curso,\n            m.fecha as start, 'clase de ' || lower(m.nombre) as title, c.img\n            from curso c\n            inner join modulos m\n            on m.curso = c._id\n            inner join matricula ma\n            on ma.curso = c._id\n            inner join factura fact\n            on ma.factura=fact._id\n            where fact.estudiante = $1\n            and m.fecha > now()",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,classModules:r})}catch(o){(0,s.default)(o,e,t)}}))},6891:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCommentsChild=t.addDislike=t.addLike=t.deleteComment=t.getCommentsByCourse=t.addNewComment=void 0;const i=o(1580),s=r(o(7549)),a=o(5828);t.addNewComment=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{titulo:o,mensaje:n,curso_id:r,type:s,comment_id:c}=e.body,u=s,{uid:d}=e.decoded,l=(0,a.v4)();return"main"===u?yield(0,i.query)("insert into comentario(_id, usuario, curso, titulo, mensaje, fecha) \n                values($1,$2, $3, $4, $5, $6)",[l,d,r,o,n,new Date]):"child"===u&&(yield(0,i.query)("insert into comentario(_id, usuario, curso, mensaje, fecha, respuesta)\n                values($1, $2, $3, $4, $5, $6)",[l,d,r,n,new Date,c])),t.json({ok:!0,id:l})}catch(o){return(0,s.default)(o,e,t)}})),t.getCommentsByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{uid:n}=e.decoded,{rows:r}=yield(0,i.query)("select com.*,com.usuario as estudiante_id,\n                (select jsonb_object_agg(likes, total)\n                from (\n                    select count(*) as total,\n                        case when li.hashlike <> true\n                            then 'dislikes'\n                            else 'likes'\n                        end as likes\n                    from likes li\n                    where com._id=li.comentario\n                    group by hashlike\n                ) t) as detalle,\n                (select li.hashlike \n                    from likes li\n                    where li.usuario=$1\n                    and li.comentario=com._id\n                )\n            from comentario com\n            inner join curso c\n            on c._id=com.curso\n            inner join usuario u\n            on u._id=com.usuario\n            where c._id=$2\n            and com.respuesta is null\n            order by com.fecha desc",[n,o]);return t.json({ok:!0,comments:r})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteComment=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.id;return yield(0,i.query)("delete from comentario where _id=$1",[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.addLike=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.body.comment,{uid:n}=e.decoded;return null===o.hashlike?yield(0,i.query)("insert into likes(comentario, usuario, hashlike)\n                values($1,$2,$3)",[o._id,n,!0]):!0===o.hashlike?yield(0,i.query)("delete from likes where comentario=$1 and usuario=$2",[o._id,n]):!1===o.hashlike&&(yield(0,i.query)("update likes set hashlike=true \n                    where comentario=$1 and usuario=$2",[o._id,n])),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.addDislike=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.body.comment,{uid:n}=e.decoded;return null===o.hashlike?yield(0,i.query)("insert into likes(comentario, usuario, hashlike)\n                    values($1,$2,$3)",[o._id,n,!1]):!0===o.hashlike?yield(0,i.query)("update likes set hashlike=false \n                    where comentario=$1 and usuario=$2",[o._id,n]):!1===o.hashlike&&(yield(0,i.query)("delete from likes where comentario=$1 and usuario=$2",[o._id,n])),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getCommentsChild=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{id:o}=e.params,{uid:n}=e.decoded,{rows:r}=yield(0,i.query)("select com.*,com.usuario as estudiante_id,\n                (select jsonb_object_agg(likes, total)\n                from (\n                    select count(*) as total,\n                        case when li.hashlike <> true\n                            then 'dislikes'\n                            else 'likes'\n                        end as likes\n                    from likes li\n                    where com._id=li.comentario\n                    group by hashlike\n                ) t) as detalle,\n                (select li.hashlike \n                    from likes li\n                    where li.usuario=$1\n                    and li.comentario=com._id\n                )\n            from comentario com\n            inner join curso c\n            on c._id=com.curso\n            inner join usuario u\n            on u._id=com.usuario\n            where com.respuesta=$2\n            order by com.fecha desc",[n,o]);return t.json({ok:!0,comments:r})}catch(o){return(0,s.default)(o,e,t)}}))},2109:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.setScore=t.getReportsScore=t.updateActivity=t.deleteActivity=t.createActivity=t.deleteTActividad=t.editTipoActividad=t.addTipoActividad=t.getTipoActividad=t.deleteHora=t.updateHora=t.addHoraHorario=t.getHorarioByCourse=t.deleteReq=t.updateReq=t.addReq=t.getAllRequirements=t.deleteTarget=t.updateTarget=t.getAllTargets=t.addTarget=t.deleteTema=t.editTema=t.addNewTema=t.updateModuleLink=t.updateModule=t.deleteModule=t.getModulesByCourse=t.createModule=t.searchCourse=t.getAllCourses=void 0;const i=o(1580),s=r(o(7549)),a=r(o(8114));t.getAllCourses=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.pagina,n=10;let r=n*Number(o)-n;const{uid:s}=e.decoded,{rows:a}=yield(0,i.query)("select count(*) as total_registros from curso where profesor = $1 and certificado=false",[s]),c="select * from curso where profesor=$1 and certificado=false order by _id limit $2 offset $3;";r<0&&(r=0);const{rows:u}=yield(0,i.query)(c,[s,n,r]);return t.json({ok:!0,totalReg:a[0].total_registros,docs:u})}catch(o){return(0,s.default)(o,e,t)}})),t.searchCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{search:o,input:n}=e.body,{uid:r}=e.decoded;let s="";const a=e.params.pagina,c=10,u=c*Number(a)-c;switch(o){case"nombre":s="c.nombre";break;case"nivel":s="n.nombre";break;case"precio":s="CAST(precio AS TEXT)";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const d=`select count(*) \n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.profesor=$1\n            and unaccent(${s}) like unaccent('%${n}%')`,{rows:l}=yield(0,i.query)(d,[r]),f=`select c.* \n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where c.profesor=$1\n            and unaccent(lower(${s})) like unaccent('%'||lower('${n}')||'%')\n            limit $2\n            offset $3`,{rows:p}=yield(0,i.query)(f,[r,c,u]);return t.json({ok:!0,totalReg:l[0].count,docs:p})}catch(o){return(0,s.default)(o,e,t)}})),t.createModule=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{nombre:n,descripcion:r}=e.body,s="insert into modulos(curso,nombre, descripcion) values($1, $2, $3) RETURNING *",{rows:a}=yield(0,i.query)(s,[o,n,r||null]);return t.json({ok:!0,module:a[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getModulesByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid;yield(0,i.query)("BEGIN");const{rows:n}=yield(0,i.query)("select * from modulos where curso = $1 order by _id",[o]),r=n;for(const e in r){const{rows:t}=yield(0,i.query)("select * from temario where modulo = $1 order by _id",[r[e]._id]),o=t;r[e].temario=o}return yield(0,i.query)("COMMIT"),t.json({ok:!0,modulos:r})}catch(o){return yield(0,i.query)("ROLLBACK"),(0,s.default)(o,e,t)}})),t.deleteModule=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o,mid:n}=e.params,r="delete from modulos where _id=$1 and curso=$2;";return yield(0,i.query)(r,[n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.updateModule=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o,mid:n}=e.params,{nombre:r,descripcion:s}=e.body,a="update modulos set \n            nombre=$1, \n            descripcion=$2\n            where _id=$3 \n            and curso=$4;";return yield(0,i.query)(a,[r,s||null,n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.updateModuleLink=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o,mid:n}=e.params,{enlace:r,fecha:s}=e.body,a="update modulos set \n            enlace=$1,\n            fecha=$2\n            where _id=$3 \n            and curso=$4;";return yield(0,i.query)(a,[r,s,n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.addNewTema=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{mid:o}=e.params,{nombre:n}=e.body,r="insert into temario(modulo, nombre) values($1, $2) returning *",{rows:s}=yield(0,i.query)(r,[o,n]);return t.json({ok:!0,tema:s[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.editTema=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{tid:o}=e.params,{nombre:n}=e.body,r="update temario set nombre=$1 where _id=$2";return yield(0,i.query)(r,[n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteTema=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{tid:o}=e.params,n="delete from temario where _id=$1";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.addTarget=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{nombre:n}=e.body,r="insert into objetivos(nombre,curso) values($1,$2) RETURNING *",{rows:s}=yield(0,i.query)(r,[n,o]);return t.json({ok:!0,target:s[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getAllTargets=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select * from objetivos where curso = $1 order by _id",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,targets:r})}catch(o){return(0,s.default)(o,e,t)}})),t.updateTarget=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{oid:o}=e.params,{nombre:n}=e.body,r="update objetivos set nombre=$1 where _id=$2";return yield(0,i.query)(r,[n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteTarget=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{oid:o}=e.params,n="delete from objetivos where _id=$1";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getAllRequirements=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select * from requisitos where curso = $1 order by _id",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,req:r})}catch(o){return(0,s.default)(o,e,t)}})),t.addReq=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{nombre:n}=e.body,r="insert into requisitos(nombre,curso) values($1,$2) RETURNING *",{rows:s}=yield(0,i.query)(r,[n,o]);return t.json({ok:!0,req:s[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.updateReq=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{rid:o}=e.params,{nombre:n}=e.body,r="update requisitos set nombre=$1 where _id=$2";return yield(0,i.query)(r,[n,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteReq=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{rid:o}=e.params,n="delete from requisitos where _id=$1";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getHorarioByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select * from horario where curso = $1 order by _id",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,horario:r})}catch(o){return(0,s.default)(o,e,t)}})),t.addHoraHorario=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{hora_i:n,hora_f:r,dia:s}=e.body,a="insert into horario(curso,hora_i,hora_f,dia) values($1,$2,$3,$4) RETURNING *",{rows:c}=yield(0,i.query)(a,[o,n,r,s]);return t.json({ok:!0,hora:c[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.updateHora=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{hid:o}=e.params,{hora_f:n,hora_i:r,dia:s}=e.body,a="update horario set hora_i=$1, hora_f=$2, dia=$3 where _id=$4";return yield(0,i.query)(a,[r,n,s,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteHora=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{hid:o}=e.params,n="delete from horario where _id=$1";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getTipoActividad=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select * from tipo_actividad where curso=$1 order by _id;",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,tActividades:r})}catch(o){return(0,s.default)(o,e,t)}})),t.addTipoActividad=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{nombre:o,curso:n,porcentaje:r}=e.body,s="insert into tipo_actividad(curso, nombre, porcentaje) values($1,$2,$3) RETURNING *",{rows:a}=yield(0,i.query)(s,[n,o,r]);return t.json({ok:!0,tActividad:a[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.editTipoActividad=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{nombre:o,curso:n,porcentaje:r,_id:s}=e.body,a="update tipo_actividad set nombre=$1, porcentaje=$2 where _id=$3 and curso=$4;";return yield(0,i.query)(a,[o,r,s,n]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteTActividad=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{taid:o}=e.params,n="delete from tipo_actividad where _id=$1";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.createActivity=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid;yield(0,i.query)("BEGIN");const{nombre:n,tipo:r,intentos:s,url_adj:c,f_limite:u,descripcion:d}=e.body,{rows:l}=yield(0,i.query)("select f_inicio from curso where _id=$1",[o]),f=(0,a.default)(new Date(l[0].f_inicio));if(f.isAfter(new Date))throw{status:400,msg:`No puedes asignar actividades hasta que se \n                cierren las inscripciones el ${f.format("dddd DD [de] MMMM [del] yyyy")}`};const{rows:p}=yield(0,i.query)("insert into actividades(nombre, tipo, intentos, url_adjunto_prof, f_limite, descripcion) \n            values($1,$2,$3,$4, $5, $6) RETURNING *",[n,r,s,c||null,u,d]),m="insert into reporte (estudiante, actividad)\n            SELECT fact.estudiante, a._id\n            FROM matricula m \n            inner join factura fact\n            on m.factura=fact._id, actividades a\n            WHERE m.curso=$1\n            AND a._id=$2;";return yield(0,i.query)(m,[o,p[0]._id]),yield(0,i.query)("COMMIT"),t.json({ok:!0,activity:p[0]})}catch(o){return yield(0,i.query)("ROLLBACK"),(0,s.default)(o,e,t)}})),t.deleteActivity=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{aid:o}=e.params;return yield(0,i.query)("delete from actividades where _id=$1",[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.updateActivity=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{aid:o}=e.params,{nombre:n,url_adj:r,f_limite:s,descripcion:a,intentos:c}=e.body;return yield(0,i.query)("update actividades set\n            nombre=$1,\n            url_adjunto_prof=$2,\n            f_limite=$3,\n            descripcion=$4,\n            intentos=$5\n            where _id=$6",[n,r,s,a,c,o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getReportsScore=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{aid:o}=e.params,n="select e._id, r.url_adjunto_est, \n            r.observaciones, r.calificacion, r.intentos\n            from reporte r\n            inner join usuario e\n            on r.estudiante = e._id\n            where actividad=$1\n            order by _id",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,reports:r})}catch(o){return(0,s.default)(o,e,t)}})),t.setScore=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{est:o,act:n}=e.params,{calificacion:r,observaciones:s}=e.body,a="update reporte set \n            calificacion=$1,\n            observaciones=$2\n            where estudiante=$3\n            and actividad=$4";return yield(0,i.query)(a,[r,s,o,n]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}}))},9880:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.searchPayments=t.getPayments=t.paymentCourses=t.deleteShoppingCart=t.deleteItemFromShoppingCart=t.getShoppingCartPending=t.addCourseToShoppingCart=t.createShoppingCart=void 0;const i=o(1580),s=r(o(7549)),a=o(5828);t.createShoppingCart=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.decoded,{course:n,price:r}=e.body;yield(0,i.query)("BEGIN");const{rows:s}=yield(0,i.query)("insert into factura(_id, estudiante, fecha, estado)\n                values($1, $2, $3, $4) RETURNING _id",[(0,a.v4)(),o,new Date,"pendiente"]);return yield(0,i.query)("insert into matricula(_id, factura, curso,precio_compra) values($1,$2,$3,$4)",[(0,a.v4)(),s[0]._id,n,r]),yield(0,i.query)("COMMIT"),t.json({ok:!0,_id:s[0]._id})}catch(o){return yield(0,i.query)("ROLLBACK"),(0,s.default)(o,e,t)}})),t.addCourseToShoppingCart=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params._id,{course:n,price:r}=e.body,s="insert into matricula(_id, factura, curso,precio_compra) values($1,$2,$3,$4)";return yield(0,i.query)(s,[(0,a.v4)(),o,n,r]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getShoppingCartPending=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.decoded,{rows:r}=yield(0,i.query)("select ma._id as shoppingId, c._id, c.cupos,\n            c.img, c.nombre as name, c.precio as price, fact._id as factura_id\n            from factura fact\n            inner join matricula ma\n            on ma.factura=fact._id\n            inner join curso c\n            on ma.curso=c._id\n            where fact.estudiante=$1\n            and fact.estado='pendiente'",[o]),s=[];return r.forEach((e=>n(void 0,void 0,void 0,(function*(){const{cupos:t,shoppingid:o}=e;Number(t)<=0?yield(0,i.query)("delete from matricula where _id=$1",[o]):s.push(e)})))),t.json({ok:!0,courses:s})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteItemFromShoppingCart=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params._id,n="delete from matricula where _id=$1;";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteShoppingCart=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params._id,n="delete from factura where _id=$1;";return yield(0,i.query)(n,[o]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.paymentCourses=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{shoppingCartId:o,id_transaction:r,total:s}=e.body,{rows:a}=yield(0,i.query)("select c._id,c.cupos, fact._id as factura\n            from factura fact\n            inner join matricula mat\n            on mat.factura=fact._id\n            inner join curso c\n            on mat.curso=c._id\n            where fact._id=$1",[o]);return a.forEach((({cupos:e,factura:t,_id:o})=>n(void 0,void 0,void 0,(function*(){Number(e)>0&&(yield(0,i.query)("update factura set estado=$1, transaccion=$2, total=$3 where _id=$4",["pagado",r,s,t]),yield(0,i.query)("update curso set cupos=$1 where _id=$2",[Number(e)-1,o]))})))),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.getPayments=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.page,n=10;let r=n*Number(o)-n;const{uid:s}=e.decoded,{rows:a}=yield(0,i.query)("select count(*) as num_registros from factura where estudiante = $1 and estado='pagado';",[s]);r<0&&(r=0);const{rows:c}=yield(0,i.query)("select fact.*, \n            json_agg(json_build_object('_id', c._id, 'nombre', c.nombre, 'precio', ma.precio_compra)) as cursos\n            from factura fact\n            inner join matricula ma\n            on fact._id=ma.factura\n            inner join curso c\n            on c._id=ma.curso\n            where fact.estudiante=$1\n            and fact.estado='pagado'\n            group by fact._id\n            order by fact._id  \n            limit $2 \n            offset $3",[s,n,r]);return t.json({ok:!0,numRegistros:a[0].num_registros,bill:c})}catch(o){return(0,s.default)(o,e,t)}})),t.searchPayments=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{type:o,input:n}=e.query,{uid:r}=e.decoded;let s="";const a=e.params.page,c=10,u=c*Number(a)-c;switch(o){case"transaccion":s="fact.transaccion";break;case"id_factura":s="fact._id";break;case"fecha":s="fact.fecha";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const d=`select count(*) \n            from factura fact\n            where fact.estudiante=$1\n            and fact.estado='pagado'\n            and ${s}=$2`,{rows:l}=yield(0,i.query)(d,[r,n]),f=`select fact.*\n            from factura fact\n            where fact.estudiante=$1\n            and fact.estado='pagado'\n            and ${s}=$2\n            limit $3\n            offset $4`,{rows:p}=yield(0,i.query)(f,[r,n,c,u]);return t.json({ok:!0,numRegistros:l[0].count,bill:p})}catch(o){return(0,s.default)(o,e,t)}}))},6716:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMyCoursesCertificates=t.getMyCourses=t.verifyEnrollment=t.getModulosByCourse=t.getReqByCourse=t.getTargetByCourse=t.getCourseDetail=t.getCourseByIdAndStudent=t.searchCourseShop=t.getCoursesShop=void 0;const i=o(1580),s=r(o(7549));t.getCoursesShop=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.pagina,n=10;let r=n*Number(o)-n;const{rows:s}=yield(0,i.query)("select count(*) as total_registros from curso \n                where f_inicio >= now()\n                and publicar=true\n                and certificado=false\n                and cupos > 0"),a="select c._id, c.nombre, c.descripcion, n.nombre as nivel, \n            c.precio, c.profesor, c.img, c.f_inicio\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            where f_inicio >= now()\n            and publicar=true\n            and certificado=false\n            and cupos > 0\n            limit $1\n            offset $2";r<0&&(r=0);const{rows:c}=yield(0,i.query)(a,[n,r]);return t.json({ok:!0,totalReg:Number(s[0].total_registros),docs:c})}catch(o){return(0,s.default)(o,e,t)}})),t.searchCourseShop=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{search:o,input:n}=e.body;let r="";switch(o){case"nombre":r="c.nombre";break;case"nivel":r="n.nombre";break;case"precio":r="CAST(precio AS TEXT)";break;default:throw{status:400,msg:"Ninguna de las opciones de búsqueda especificadas es válida"}}const s=`select count(*) \n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where f_inicio >= now()\n            and publicar=true\n            and certificado=false\n            and cupos > 0\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:a}=yield(0,i.query)(s),c=`select c.*, n.nombre as nivel\n            from curso c\n            inner join nivel n\n            on n._id = c.nivel\n            where f_inicio >= now()\n            and publicar=true\n            and certificado=false\n            and cupos > 0\n            and unaccent(lower(${r})) like unaccent('%'||lower('${n}')||'%')`,{rows:u}=yield(0,i.query)(c);return t.json({ok:!0,totalReg:Number(a[0].count),docs:u})}catch(o){return(0,s.default)(o,e,t)}})),t.getCourseByIdAndStudent=(e,t)=>n(void 0,void 0,void 0,(function*(){try{yield(0,i.query)("BEGIN");const{cid:o}=e.params,{uid:n}=e.decoded,r="select c._id, c.nombre, c.descripcion, n.nombre as nivel, \n            c.precio, c.profesor, c.img, c.f_inicio, c.detail, c.cupos\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            where c._id=$1",{rows:s}=yield(0,i.query)(r,[o]);let a=s[0];const c="select fact.estado as matricula_estado, ma._id as matricula_id\n            from factura fact \n            inner join matricula ma\n            on ma.factura=fact._id\n            where ma.curso = $1 \n            and fact.estudiante = $2;",{rows:u}=yield(0,i.query)(c,[a._id,n]);return u.length>0&&(a=Object.assign(Object.assign({},a),u[0])),yield(0,i.query)("COMMIT"),t.json({ok:!0,course:a})}catch(o){return yield(0,i.query)("ROLLBACK"),(0,s.default)(o,e,t)}})),t.getCourseDetail=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select c._id, c.nombre, c.descripcion, n.nombre as nivel, \n            c.precio, c.profesor, c.img, c.f_inicio, c.detail, c.cupos\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            where c._id=$1",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,course:r[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getTargetByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,n="select _id, nombre from objetivos where curso=$1",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,target:r})}catch(o){return(0,s.default)(o,e,t)}})),t.getReqByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,n="select _id, nombre from requisitos where curso=$1",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,req:r})}catch(o){return(0,s.default)(o,e,t)}})),t.getModulosByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,n="select _id, nombre, descripcion from modulos where curso=$1 order by _id",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,req:r})}catch(o){return(0,s.default)(o,e,t)}})),t.verifyEnrollment=(e,o)=>n(void 0,void 0,void 0,(function*(){try{const n=e.params.cid,{uid:r}=e.decoded,s="select fact.estado from matricula ma\n            inner join factura fact\n            on ma.factura=fact._id\n            where fact.estudiante=$1\n            and ma.curso=$2",{rows:a}=yield(0,i.query)(s,[r,n]);if("pagado"!==a[0].estado)throw{status:500,msg:"No tienes permisos para acceder a este curso"};return(0,t.getCourseByIdAndStudent)(e,o)}catch(t){return(0,s.default)(t,e,o)}})),t.getMyCourses=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.decoded,n="select c.*,n.nombre as nivel,\n            fact.estado as matricula_estado, ma._id as matricula_id\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            inner join matricula ma\n            on c._id = ma.curso\n            inner join factura fact\n            on ma.factura=fact._id\n            where fact.estudiante=$1\n            and fact.estado = 'pagado'\n            and c.certificado = false",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,courses:r})}catch(o){return(0,s.default)(o,e,t)}})),t.getMyCoursesCertificates=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.decoded,n="select c.*,n.nombre as nivel,\n            fact.estado as matricula_estado, ma._id as matricula_id,\n            ma.calificacion\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            inner join matricula ma\n            on c._id = ma.curso\n            inner join factura fact\n            on ma.factura=fact._id\n            where fact.estudiante=$1\n            and fact.estado = 'pagado'\n            and c.certificado = true",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,courses:r})}catch(o){return(0,s.default)(o,e,t)}}))},2599:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCountCourseProfile=t.getCoursesLanding=t.getActivitiesByCourse=t.getAllTaskByStudent=t.registerNewUser=t.verifyEnrollment=t.updateReporte=t.getReportesByStudent=t.addReporte=void 0;const i=o(1580),s=r(o(7549)),a=r(o(8114));t.addReporte=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{est:o}=e.params;let{actividad:n,url_adjunto_est:r,intentos:s}=e.body;if(s<0||void 0===s)throw{status:400,msg:"Ya ha superado el límite de intentos para esta actividad"};const a="insert into reporte(estudiante, actividad,url_adjunto_est, intentos) \n        values($1,$2,$3, $4) RETURNING actividad,calificacion,url_adjunto_est,intentos;",{rows:c}=yield(0,i.query)(a,[o,n,r,s]);return t.json({ok:!0,report:c[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getReportesByStudent=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{est:o,cid:n}=e.params,r="select r.actividad, r.calificacion, r.url_adjunto_est, r.observaciones, r.intentos \n            from reporte r\n            inner join actividades a\n            on r.actividad=a._id\n            inner join tipo_actividad ta\n            on a.tipo=ta._id\n            where estudiante=$1\n            and ta.curso=$2\n            order by r.actividad;",{rows:s}=yield(0,i.query)(r,[o,n]);return t.json({ok:!0,reports:s})}catch(o){return(0,s.default)(o,e,t)}})),t.updateReporte=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{est:o,aid:n}=e.params,{url_adjunto_est:r,intentos:s}=e.body,{rows:c}=yield(0,i.query)("select f_limite as fecha\n            from reporte re\n            inner join actividades ac\n            on ac._id=re.actividad\n            where re.estudiante=$1 and re.actividad=$2",[o,n]);if((0,a.default)(new Date).isAfter(c[0].fecha))throw{status:400,msg:"La fecha para subir la actividad ya expiró"};const u="update reporte set\n            url_adjunto_est=$1,\n            intentos=$2\n            where estudiante=$3\n            and actividad=$4;";return yield(0,i.query)(u,[r,s,o,n]),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.verifyEnrollment=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{uid:n}=e.decoded,r="select fact.estado from matricula ma \n            inner join factura fact\n            on ma.factura=fact._id\n            where curso=$1\n            and estudiante=$2",{rows:s}=yield(0,i.query)(r,[o,n]);return t.json({ok:!0,enrollment:s[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.registerNewUser=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o,rol:n}=e.body;if(!n||!o)throw{status:400,msg:"Faltan campos necesarios"};const r="insert into usuario(_id,rol) values($1,$2)";return yield(0,i.query)(r,[o,n]),t.json({ok:!0})}catch(o){return console.log(o),(0,s.default)(o,e,t)}})),t.getAllTaskByStudent=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.params,{rows:n}=yield(0,i.query)(" select ac._id, ac.nombre, tac.nombre as tipo_actividad, \n            c.nombre as curso, re.calificacion, ac.f_limite as fecha, \n            ac.intentos as intentos_actividad, re.intentos  as intentos,\n            re.url_adjunto_est, ac.url_adjunto_prof,re.observaciones, ac.descripcion,\n                case \n                    when re.intentos <> 0  \n                        then 'completo'\n                        else 'pendiente'\n                end as estado\n            from reporte re\n            inner join actividades ac\n            on re.actividad=ac._id\n            inner join tipo_actividad tac\n            on ac.tipo=tac._id\n            inner join curso c\n            on tac.curso=c._id\n            where re.estudiante=$1\n            order by ac.f_limite",[o]);return t.json({ok:!0,tasks:n})}catch(o){return console.log(o),(0,s.default)(o,e,t)}})),t.getActivitiesByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{uid:n}=e.decoded,{rows:r}=yield(0,i.query)("select tact._id,tact.nombre, tact.porcentaje,\n                json_agg(json_build_object(\n                    '_id', act._id,\n                    'actividad', act.nombre,\n                    'calificacion', re.calificacion\n                )) as actividades\n            from tipo_actividad tact\n            inner join actividades act\n            on tact._id=act.tipo\n            inner join reporte re\n            on re.actividad=act._id\n            where tact.curso=$1\n            and re.estudiante=$2\n            group by tact._id",[o,n]);return t.json({ok:!0,activities:r})}catch(o){return console.log(o),(0,s.default)(o,e,t)}})),t.getCoursesLanding=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{rows:e}=yield(0,i.query)("select c._id, c.nombre, c.descripcion, n.nombre as nivel, \n            c.precio, c.profesor, c.img, c.f_inicio\n            from curso c\n            inner join nivel n\n            on c.nivel = n._id\n            where f_inicio >= now()\n            and publicar=true\n            and certificado=false\n            and cupos > 0\n            limit 6");return t.json({ok:!0,courses:e})}catch(o){return(0,s.default)(o,e,t)}})),t.getCountCourseProfile=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{uid:o}=e.decoded,{rows:n}=yield(0,i.query)("select c.certificado, count(*) as cantidad\n                from curso c\n                inner join matricula ma\n                on ma.curso=c._id\n                inner join factura fact \n                on fact._id=ma.factura\n                where estudiante=$1\n                group by c.certificado",[o]);return t.json({ok:!0,courses:n})}catch(o){return(0,s.default)(o,e,t)}}))},4945:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getActivitiesByCourseAndStudent=t.getActivitiesByCourse=t.editNameAdjunto=t.downloadFiles=t.deleteAdjByCourse=t.getAdjuntosByCourse=t.uploadAdjunto=t.getImgPortada=t.uploadImgPortadaCourse=void 0;const i=o(1580),s=r(o(7549)),a=o(1017),c=r(o(3844)),u=o(7147);t.uploadImgPortadaCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,n=e.files,{rows:r}=yield(0,i.query)("select * from curso where _id=$1;",[o]),s=r[0];if(!s)throw{status:404,msg:"No se encontró el curso solicitado"};if(!n)throw{status:404,msg:"No existen archivos para procesar."};const c=n.portada,d=(0,a.resolve)(__dirname,"../files/portadas");(0,u.existsSync)(d)||(0,u.mkdirSync)(d,{recursive:!0}),s.img&&(0,u.existsSync)(`${d}/${s.img}`)&&(0,u.unlinkSync)(`${d}/${s.img}`),c.mv(`${d}/${c.name}`);const{rows:l}=yield(0,i.query)("update curso set img=$1 where _id=$2 RETURNING img",[c.name,s._id]);return t.json({ok:!0,img:l[0].img})}catch(o){return(0,s.default)(o,e,t)}})),t.getImgPortada=(e,t)=>{try{const o=e.params.name,n=(0,a.resolve)(__dirname,`../files/portadas/${o}`);if(!(0,u.existsSync)(n))throw{status:404,msg:"No se encuentra el archivo de imagen"};return t.sendFile(n)}catch(o){return(0,s.default)(o,e,t)}},t.uploadAdjunto=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,n=e.files,{rows:r}=yield(0,i.query)("select * from curso where _id=$1;",[o]),s=r[0];if(!s)throw{status:404,msg:"No se encontró el curso solicitado"};if(!n)throw{status:404,msg:"No existen archivos para procesar."};const c=n.adjunto,d=(0,a.resolve)(__dirname,`../files/adjuntos/${o}`);(0,u.existsSync)(d)||(0,u.mkdirSync)(d,{recursive:!0});const l=c.name.substr(0,c.name.lastIndexOf(".")),f=c.name.substring(c.name.lastIndexOf("."),c.name.length),p=`${o}-${(new Date).getTime()}${f}`;c.mv(`${d}/${p}`);const{rows:m}=yield(0,i.query)("insert into adjuntos(nombre, nombreView, curso, peso)             values($1,$2,$3,$4) RETURNING *",[p,l,s._id,c.size]);return t.json({ok:!0,adjunto:m[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getAdjuntosByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{rows:n}=yield(0,i.query)("select * from adjuntos where curso=$1",[o]);return t.json({ok:!0,adjuntos:n})}catch(o){return(0,s.default)(o,e,t)}})),t.deleteAdjByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{adjuntos:n}=e.body,r=`delete from adjuntos where _id in (${n.map((e=>e._id)).join(",")})`;yield(0,i.query)(`${r} and curso=$1`,[o]);const s=(0,a.resolve)(__dirname,`../files/adjuntos/${o}`);if(!(0,u.existsSync)(s))throw{status:404,msg:"No se encontró la ruta de archivos"};return(0,u.readdirSync)(s).forEach((e=>(0,u.unlinkSync)(`${s}/${e}`))),t.json({ok:!0})}catch(o){return(0,s.default)(o,e,t)}})),t.downloadFiles=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=e.params.cid,{adjuntos:n}=e.body,r=(0,a.resolve)(__dirname,`../files/adjuntos/${o}`);if(!(0,u.existsSync)(r))throw{status:404,msg:"No se encontró la ruta de archivos"};const i=new c.default;n.forEach((e=>{let t=`${r}/${e.nombre}`;if(!(0,u.existsSync)(t))throw{status:404,msg:`No se encontro el archivo ${e.nombre}`};i.addLocalFile(t)}));const s=`${(new Date).getTime()}.zip`,d=i.toBuffer();return t.set("Content-Type","application/octet-stream"),t.set("Content-Disposition",`attachment; filename=${s}`),t.set("Content-Length",String(d.length)),t.send(d)}catch(o){return(0,s.default)(o,e,t)}})),t.editNameAdjunto=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{_id:o,nombreview:n}=e.body,{rows:r}=yield(0,i.query)("update adjuntos set nombreView=$1 where _id=$2 RETURNING * ",[n,o]);return t.json({ok:!0,adjunto:r[0]})}catch(o){return(0,s.default)(o,e,t)}})),t.getActivitiesByCourse=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,n="select ac._id, ac.tipo, ac.intentos, ac.nombre, \n            ac.url_adjunto_prof as url_adj, ac.f_limite, ac.descripcion\n            from actividades ac\n            inner join tipo_actividad ta\n            on ta._id = ac.tipo\n            where ta.curso = $1\n            order by ac._id;",{rows:r}=yield(0,i.query)(n,[o]);return t.json({ok:!0,activities:r})}catch(o){return(0,s.default)(o,e,t)}})),t.getActivitiesByCourseAndStudent=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{cid:o}=e.params,{uid:n}=e.decoded,r="select act._id, act.tipo, act.nombre, \n            act.url_adjunto_prof, act.f_limite, act.descripcion,\n            rep.calificacion, rep.observaciones,act.intentos as intentos_actividad, rep.intentos, rep.url_adjunto_est \n            from actividades act\n            inner join reporte rep\n            on rep.actividad=act._id\n            inner join tipo_actividad ta\n            on act.tipo=ta._id\n            where rep.estudiante=$1\n            and ta.curso=$2\n            order by act._id",{rows:s}=yield(0,i.query)(r,[n,o]);return t.json({ok:!0,activities:s})}catch(o){return(0,s.default)(o,e,t)}}))},3844:e=>{e.exports=require("adm-zip")},3582:e=>{e.exports=require("cors")},6860:e=>{e.exports=require("express")},6674:e=>{e.exports=require("express-fileupload")},3553:e=>{e.exports=require("express-validator")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},2245:e=>{e.exports=require("moment")},9470:e=>{e.exports=require("morgan")},5900:e=>{e.exports=require("pg")},5828:e=>{e.exports=require("uuid")},7773:e=>{e.exports=require("winston")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")}},t={};!function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(3607)})();